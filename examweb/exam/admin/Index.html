<!doctype html>
<html lang="en">
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="icon" href="img/LH_face.png" type="img" />
    <link href="styles.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <title>HellDelivery</title>
</head>

<body class="all">
    <div class="preloader">
        <div class="preloader__row">
            <div class="preloader__item"> <img src="img/Animation.gif"></div>
        </div>
    </div>
    <script>
        window.onload = function () {
            document.body.classList.add('loaded_hiding');
            window.setTimeout(function () {
                document.body.classList.add('loaded');
                document.body.classList.remove('loaded_hiding');
            }, 500);
        }
    </script>
    <div class="priv">
        <nav class="navbar navbar-expand-lg">
            <a class="navbar-brand" href="#">
                <img src="img/malina_toggle.png">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#Mynavbar"
                aria-controls="Mynavbar" aria-expanded="false" aria-pressed="true" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon d-flex justify-content-center align-items-center"><img
                        src="img/pentaGraphic 2.png" width="40px" height="auto"></span>
            </button>
            <div class="collapse animateNav navbar-collapse justify-content-center" id="Mynavbar">
                <ul class="navbar-nav">
                    <li class="nav-item d-flex justify-content-center">
                        <a class="menu nav-link active d-inline" href="/index.html">Главная<span
                                class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item d-flex justify-content-center">
                        <a class="menu nav-link d-inline" href="#spis">Список заведений</a>
                    </li>
                    <li class="nav-item d-flex justify-content-center">
                        <a class="menu nav-link d-inline" href="#shop">Меню</a>
                    </li>
                    <li class="nav-item d-flex justify-content-center">
                        <a class="menu nav-link d-inline" href="#foot">Обратная связь</a>
                    </li>
                </ul>
                <div class="underline"></div>
            </div>
        </nav>
        <div class="prev listitems" id="spis">
            <div class="container d-flex justify-content-center">
                <h2 class="text-center mt-4">Список Заведений</h2>
            </div>
            <div class="container">
                <form name="form">
                    <div class="row justify-content-between">
                        <select class="form-control col-6 col-md-5" name="typeObject" id="typeObject">
                        </select>
                        <select class="form-control col-6 col-md-5" name="admArea" id="admArea">
                        </select>
                    </div>
                    <div class="row my-2 justify-content-between">
                        <select class="form-control col-12 col-md-5" name="socialPrivileges" id="socialPrivileges">
                        </select>
                        <div class="col-5 d-inline-flex justify-content-between">
                            <button id="poisk" type="button" onclick="btnsearch()" class="btnred">Поиск</button>
                            <button onclick="retun()" class="btnred">Сброс</button>
                        </div>
                    </div>
                </form>
                <table id="allnames" class="pt-3 w-100 sortable mx-0 px-0">
                    <thead>
                        <tr class="w-100">
                            <td class="text-uppercase d-md-table-cell">
                                <h4>Название</h4>
                            </td>
                            <td class="text-uppercase d-none d-md-table-cell text-md-center">
                                <h4>Тип</h4>
                            </td>
                            <td class="text-uppercase d-none d-md-table-cell text-center">
                                <h4>Адрес</h4>
                            </td>
                            <td class="text-uppercase text-center d-md-table-cell rate">
                                <h4>Рейтинг</h4>
                            </td>
                        </tr>
                    </thead>
                    <h2>Select Number Of Rows</h2>
                    <div class="form-group">
                        <!--		Show Numbers Of Rows 		-->
                        <select class="form-control" name="state" id="maxRows">
                            <option value="5000">Show ALL Rows</option>
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="15">15</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                            <option value="70">70</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                    <tbody id="spisok" class="spisokname mb-3">
                    </tbody>
                </table>
            </div>
        </div>
        <div class='pagination-container'>
            <nav>
                <ul class="pagination">

                    <li data-page="prev">
                        <span>
                            < <span class="sr-only">(current)
                        </span></span>
                    </li>
                    <li data-page="next" id="prev">
                        <span> > <span class="sr-only">(current)</span></span>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</body>
<script>
    var k;
    var json;
    async function test() {
        const response = await fetch('http://exam-2020-1-api.std-900.ist.mospolytech.ru/api/data1');
        const data = await response.json();
        return data;
    }
    k = test();
    console.log(k);
    let mainContent = '',
        main = document.querySelector('#spisok');
    k.then(films => {
        films.forEach(film => {
            mainContent += `
            <tr class="pos" height="74px" id="${film.id}" onclick="menucards(this)">
              <td class="d-md-table-cell  w-25">${film.name}</td>
              <td class="d-none d-md-table-cell text-md-center">${film.typeObject}</td>
              <td class="d-none d-md-table-cell" style="padding-left: 3rem !important">${film.district} ${film.address} </td>
              <td class="text-center d-md-table-cell">${film.rate}</td>
              <td class="d-none">${film.socialPrivileges}</td>
              <td class="d-none">${film.admArea}</td>
            </tr>`;
        });
        main.innerHTML = mainContent;
        admSelector()
        typeSelector()
        socialSelector()
        setTimeout(only, 1000);
    });
    getPagination('#spisok');

    $('.pagination')
                .find('li')
                .slice(1, -1)
                .remove();
            var trnum = 0;
            var maxRows = parseInt(20);
            if (maxRows == 5000) {
                $('.pagination').hide();
            } else {
                $('.pagination').show();
            }

    function getPagination(table) {
        var lastPage = 1;

        $('#maxRows').on('change', function (evt) {
            lastPage = 1;
            $('.pagination')
                .find('li')
                .slice(1, -1)
                .remove();
            var trnum = 0;
            var maxRows = parseInt($(this).val());
            if (maxRows == 5000) {
                $('.pagination').hide();
            } else {
                $('.pagination').show();
            }

            var totalRows = $(table + ' tbody tr').length;
            $(table + ' tr:gt(0)').each(function () {
                trnum++;
                if (trnum > maxRows) {
                    $(this).hide();
                }
                if (trnum <= maxRows) {
                    $(this).show();
                }
            });
            if (totalRows > maxRows) {
                var pagenum = Math.ceil(totalRows / maxRows);
                for (var i = 1; i <= pagenum;) {
                    $('.pagination #prev').before('<li data-page="' +i +'">\<span>' +i++ +'<span class="sr-only">(current)</span></span>\</li>').show();
                }
            }
            $('.pagination [data-page="1"]').addClass('active');
            $('.pagination li').on('click', function (evt) {
                evt.stopImmediatePropagation();
                evt.preventDefault();
                var pageNum = $(this).attr('data-page');
                var maxRows = parseInt($('#maxRows').val());
                if (pageNum == 'prev') {
                    if (lastPage == 1) {
                        return;
                    }
                    pageNum = --lastPage;
                }
                if (pageNum == 'next') {
                    if (lastPage == $('.pagination li').length - 2) {
                        return;
                    }
                    pageNum = ++lastPage;
                }
                lastPage = pageNum;
                var trIndex = 0;
                $('.pagination li').removeClass('active');
                $('.pagination [data-page="' + lastPage + '"]').addClass('active');
                limitPagging();
                $(table + ' tr:gt(0)').each(function () {
                    trIndex++;
                    if (
                        trIndex > maxRows * pageNum ||
                        trIndex <= maxRows * pageNum - maxRows
                    ) {
                        $(this).hide();
                    } else {
                        $(this).show();
                    }
                });
            });
            limitPagging();
        }).val(20).change();
    }

    function limitPagging() {
        if ($('.pagination li').length > 7) {
            if ($('.pagination li.active').attr('data-page') <= 3) {
                $('.pagination li:gt(5)').hide();
                $('.pagination li:lt(5)').show();
                $('.pagination [data-page="next"]').show();
            } if ($('.pagination li.active').attr('data-page') > 3) {
                $('.pagination li:gt(0)').hide();
                $('.pagination [data-page="next"]').show();
                for (let i = (parseInt($('.pagination li.active').attr('data-page')) - 2); i <= (parseInt($('.pagination li.active').attr('data-page')) + 2); i++) {
                    $('.pagination [data-page="' + i + '"]').show();

                }

            }
        }
    }

    $(function () {
        $('table tr:eq(0)').prepend('<th class="d-none"> ID </th>');

        var id = 0;

        $('table tr:gt(0)').each(function () {
            id++;
            $(this).prepend('<td class="d-none">' + id + '</td>');
        });
    });
</script>

</html>